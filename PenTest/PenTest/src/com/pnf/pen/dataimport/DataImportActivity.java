package com.pnf.pen.dataimport;

import java.util.ArrayList;

import android.app.Activity;
import android.app.Dialog;
import android.os.Bundle;
import android.widget.ListView;
import android.widget.ScrollView;
import android.widget.TextView;

import com.pnf.pen.test.MainDefine;
import com.pnf.pen.test.R;

public class DataImportActivity extends Activity{
	final byte ALERTVIEW_DI_DOWNLOAD_SUCCESS = 0x00;
	final byte ALERTVIEW_DI_DOWNLOAD_FAIL = 0x01;
	final byte ALERTVIEW_DI_DELETE_SUCCESS = 0x02;
	final byte ALERTVIEW_DI_DELETE_FAIL = 0x03;
	
	ListView dataImportFolderListView;
	ListView dataImportFileListView;
	
	DataImportFolderListViewAdapter folderListViewAdapter;
	DataImportFileListViewAdapter fileListViewAdapter;
	
	ScrollView dataImportWriteLogScrollView;
	TextView dataImportWriteLogTextView;
	
	ArrayList<String> diFolderNameList = new ArrayList<String>();
	ArrayList<String> diFileNameList = new ArrayList<String>();
	
	Dialog mDialog;
	
	boolean isHasFocus = false;
	
	boolean isAllDownload = false;
	boolean isDownload = false;
	boolean isDelete = false;
	
	int envDataCnt = 0;
	int mFolderSelect = 0;
	int mFileSelect = 0;
	
	@Override
	public void onCreate(Bundle savedInstanceState) 
	{
		super.onCreate(savedInstanceState);
		
		setContentView(R.layout.di_data_main);
		
		dataImportFolderListView = (ListView) findViewById(R.id.dataImportFolderListView);
		dataImportFileListView = (ListView) findViewById(R.id.dataImportFileListView);
		
		dataImportWriteLogScrollView = (ScrollView) findViewById(R.id.dataImportWriteLogScrollView);
		dataImportWriteLogTextView = (TextView) findViewById(R.id.dataImportWriteLogTextView);
		
		initData();
	}
	
	void initData(){
		if(diFolderNameList != null) diFolderNameList.clear();
		if(diFileNameList != null) diFileNameList.clear();
		
		diFolderNameList = MainDefine.penController.getDIFolderNameList();
		
		folderListViewAdapter = new DataImportFolderListViewAdapter(this ,diFolderNameList);
		dataImportFolderListView.setAdapter(folderListViewAdapter);
		
		fileListViewAdapter = new DataImportFileListViewAdapter(this ,diFileNameList);
		dataImportFileListView.setAdapter(fileListViewAdapter);
		
		dataImportFolderListView.setVerticalFadingEdgeEnabled(false);
		dataImportFileListView.setVerticalFadingEdgeEnabled(false);
	}
	
//	@Override
//	public void onResume()
//	{
//		super.onResume();
//		
//		if(MainDefine.penController != null){
//			MainDefine.penController.SetRetObjForEnv(PenHandlerEnv);
//			MainDefine.penController.SetRetObjForDI(PenHandlerDI);
//			MainDefine.penController.SetRetObjForFunc(PenHandlerFunc);
//		}
//		
//		MainDefine.SetRetObj(null);
//		MainDefine.SetRetObjForMsg(messageHandler);
//	}
//
//
//	@Override
//	public void onPause() 
//	{
//		super.onPause();
//	}
//	
//	@Override
//	public void onStart(){
//    	super.onStart();
//    }
//	
//	@Override
//	public void onConfigurationChanged(Configuration newConfig){
//		super.onConfigurationChanged(newConfig);
//	}
//	
//	@Override
//	public void onBackPressed() 
//	{		
//		Intent intent = new Intent();
//		
//		setResult(RESULT_OK,intent);
//		finish();
//		return;
//	}
//
//    @Override
//    public void onDestroy()
//    {
//    	super.onDestroy();
//    }
//    
//    @Override
//    public void onWindowFocusChanged(boolean hasFocus) {
//    	isHasFocus = hasFocus;
//    }
//    
//	void addDebugText(String text) {
//    	String orgText = dataImportWriteLogTextView.getText().toString();
//    	String inputText = "";
//    	if(orgText.isEmpty()){
//    		inputText = text;
//    	}else{
//    		inputText = orgText + "\n" + text;
//    	}
//    	
//    	dataImportWriteLogTextView.setText(inputText);
//    	dataImportWriteLogScrollView.post(new Runnable() {       
//    		@Override
//    		public void run() {
//    			dataImportWriteLogScrollView.fullScroll(View.FOCUS_DOWN);              
//    		}
//    	});
//    }
//	
//	void resetDiFolderList() {
//		mFolderSelect = 0;
//		mFileSelect = 0;
//		
//		if(diFolderNameList != null) diFolderNameList.clear();
//		if(diFileNameList != null) diFileNameList.clear();
//		
//		diFolderNameList = MainDefine.penController.getDIFolderNameList();
//		
//		folderListViewAdapter.setImportFolderNameList(diFolderNameList);
//		folderListViewAdapter.notifyDataSetChanged();
//		
//		fileListViewAdapter.setImportFileNameList(diFileNameList);
//		fileListViewAdapter.notifyDataSetChanged();
//	}
//	
//	void resetDiFileList() {
//		String folderName = folderListViewAdapter.getImportFolderName(mFolderSelect);
//		
//		if(diFileNameList != null) diFileNameList.clear();
//		
//		diFileNameList = MainDefine.penController.getDIFileNameList(folderName);
//		
//		if(diFileNameList == null || diFileNameList.size() == 0){
//			resetDiFolderList();
//		}else{
//			fileListViewAdapter.setImportFileNameList(diFileNameList);
//			fileListViewAdapter.notifyDataSetChanged();
//		}
//	}
//	
//	public void dataImportCellFolderBtnClicked(View v) {
//		if(isAllDownload || isDownload || isDelete) return;
//		
//		int btnTag = Integer.parseInt(v.getTag().toString());
//		
//		mFolderSelect = btnTag;
//		
//		resetDiFileList();
//	}
//	
//	public void dataImportCellDownloadBtnClicked(View v){
//		if(isAllDownload || isDownload || isDelete) return;
//		
//		int btnTag = Integer.parseInt(v.getTag().toString());
//		mFileSelect = btnTag;
//		
//		envDataCnt = 0;
//		isAllDownload = false;
//		isDownload = true;
//		isDelete = false;
//		
//		String folderName = folderListViewAdapter.getImportFolderName(mFolderSelect);
//		String fileName = fileListViewAdapter.getImportFileName(mFileSelect);
//		
//		MainDefine.penController.OpenFileTobyte(folderName ,fileName);
//		
//		showProgress();
//	}
//	
//	public void dataImportCellDeleteBtnClicked(View v){
//		if(isAllDownload || isDownload || isDelete) return;
//		
//		int btnTag = Integer.parseInt(v.getTag().toString());
//		mFileSelect = btnTag;
//		
//		envDataCnt = 0;
//		isAllDownload = false;
//		isDownload = false;
//		isDelete = true;
//		
//		String folderName = folderListViewAdapter.getImportFolderName(mFolderSelect);
//		String fileName = fileListViewAdapter.getImportFileName(mFileSelect);
//		
//		MainDefine.penController.DeleteFileTobyte(folderName ,fileName);
//		
//		showProgress();
//	}
//	
//	public void dataImportMenuBtnClicked(View v){
//		dataImportMenuBtnClicked(Integer.parseInt(v.getTag().toString()));
//	}
//	
//	void dataImportMenuBtnClicked(int btnTag){
//		if(isAllDownload || isDownload || isDelete) return;
//		
//		if(btnTag == getResInt(R.integer.DATAIMPORT_MENU_BUTTON_ID_ALL_DOWNLOAD)){
//			procAllDownload();
//		}else if(btnTag == getResInt(R.integer.DATAIMPORT_MENU_BUTTON_ID_FORMAT)){
//			
//		}else if(btnTag == getResInt(R.integer.DATAIMPORT_MENU_BUTTON_LOG_CLEAR)){
//			procLogClear();
//		}else if(btnTag == getResInt(R.integer.DATAIMPORT_MENU_BUTTON_ID_STOP)){
//			procAllStop();
//		}
//	}
//	
//	void procAllDownload(){
//		envDataCnt = 0;
//		isAllDownload = true;
//		isDownload = false;
//		isDelete = false;
//		mFileSelect = 0;
//	}
//	
//	void procLogClear(){
//		dataImportWriteLogTextView.setText("");
//    }
//	
//	void procAllStop(){
//		envDataCnt = 0;
//		isAllDownload = false;
//		isDownload = false;
//		isDelete = false;
//		
//		mFileSelect = 0;
//	}
//    
//	/*
//	 * PNF_ENV_DATA
//	 */
//	@SuppressLint("HandlerLeak")
//	Handler PenHandlerEnv = new Handler() 
//	{
//		@Override
//		public void handleMessage(Message msg) 
//		{
//			onPenEnvEvent(msg.what ,msg.obj);
//		}
//	};
//	
//	void onPenEnvEvent(int what ,Object obj)
//	{
//		switch(what)
//		{
//		case PNFDefine.PNF_ENV_DATA:
//			if(++envDataCnt > 1){
//				envDataCnt = 0;
//				if(isAllDownload){
////					MainDefine.diFileStateList.set(mSelectIndex, MainDefine.IMPORT_STATE_FAIL);
////					dataImportListViewAdapter.importStateUpdate(mSelectIndex, MainDefine.IMPORT_STATE_FAIL);
////					
////					if(existDownloadFile()){
////						Log.e("0515", "PEN_DI_DATA OpenFileTobyte mSelectIndex==>"+mSelectIndex);
////						MainDefine.penController.OpenFileTobyte(mSelectIndex);
////						
////						MainDefine.diFileStateList.set(mSelectIndex, MainDefine.IMPORT_STATE_DOWNLOADING);
////						
////						dataImportListViewAdapter.importStateUpdate(mSelectIndex, MainDefine.IMPORT_STATE_DOWNLOADING);
////					}else{
////						isAllDownload = false;
////					}
////					
////					dataImportListViewAdapter.notifyDataSetChanged();
//				}else if(isDownload){
//					isDownload = false;
//					
//					resetDiFileList();
//					
//					stopProgress();
//					
//					showAlertView(ALERTVIEW_DI_DOWNLOAD_FAIL);
//				}
//			}
//			break;
//		}
//	}
//	
//	/*
//	 * 
//	 * BATTERY_INFO
//	 * NEW_PAGE
//	 * DUPLICATE_PAGE
//	 * CHANGE_DEVECE_POSITION
//	 * CHANGE_DEVECE_POSITION_FIRST
//	 * 
//	 */
//	@SuppressLint("HandlerLeak")
//	Handler PenHandlerFunc = new Handler() 
//	{
//		@Override
//		public void handleMessage(Message msg) 
//		{
//			onPenFuncEvent(msg.what ,msg.arg1 ,msg.arg2);
//		}
//	};
//	
//	void onPenFuncEvent(int what ,int batteryStation ,int batteryPen)
//	{
//		switch(what)
//		{
//		case PNFDefine.BATTERY_INFO:
//			addDebugText("BATTERY_INFO");
//			break;
//		case PNFDefine.NEW_PAGE:
//			addDebugText("NEW_PAGE");
//			break;
//		case PNFDefine.DUPLICATE_PAGE:
//			addDebugText("DUPLICATE_PAGE");
//			break;
//		case PNFDefine.CHANGE_DEVECE_POSITION:
//			addDebugText("CHANGE_DEVECE_POSITION");
//			break;
//		case PNFDefine.CHANGE_DEVECE_POSITION_FIRST:
//			addDebugText("CHANGE_DEVECE_POSITION_FIRST");
//			break;
//		
//		}
//	}
//	
//	/*
//	 * PEN_DI_DATA
//	 * PEN_DI_TEMPLETE
//	 * PEN_DI_ACC_DATA
//	 * PEN_DI_DELETE
//	 * PNF_DI_START
//	 * PNF_DI_STOP
//	 * PNF_DI_OK
//	 * PNF_DI_FAIL
//	 * PNF_DI_TEMP_EXIST
//	 * PNF_DI_TEMP_FILE_COMPLETE
//	 * PNF_DI_FILE_LIST_COMPLETE
//	 */
//	@SuppressLint("HandlerLeak")
//	Handler PenHandlerDI = new Handler() 
//	{
//		@Override
//		public void handleMessage(Message msg) 
//		{
//			onPenDIEvent(msg.what ,msg.arg1 ,msg.obj);
//		}
//	};
//	
//	void onPenDIEvent(int what ,int diPapersize ,Object obj)
//	{
//		switch(what)
//		{
//		case PNFDefine.PEN_DI_DATA:
//			ArrayList<PenDataClass> penDIDataArray = (ArrayList<PenDataClass>)obj;
//
//			addDebugText("PEN_DI_DATA");
//			addDebugText("PEN_DI_DATA has " + String.valueOf(penDIDataArray.size()) + " stroke.");
//			//			
//			//			MainDefine.diFileStateList.set(mSelectIndex, MainDefine.IMPORT_STATE_SUCCESS);
//			//			dataImportListViewAdapter.importStateUpdate(mSelectIndex, MainDefine.IMPORT_STATE_SUCCESS);
//			//			
//			envDataCnt = 0;
//			if(isAllDownload){
//				//				if(existDownloadFile()){
//				//					MainDefine.penController.OpenFileTobyte(mSelectIndex);
//				//					
//				//					MainDefine.diFileStateList.set(mSelectIndex, MainDefine.IMPORT_STATE_DOWNLOADING);
//				//					
//				//					dataImportListViewAdapter.importStateUpdate(mSelectIndex, MainDefine.IMPORT_STATE_DOWNLOADING);
//				//				}else{
//				//					isAllDownload = false;
//				//				}
//			}else{
//				isDownload = false;
//
//				resetDiFileList();
//
//				stopProgress();
//
//				showAlertView(ALERTVIEW_DI_DOWNLOAD_SUCCESS);
//			}
//			break;
//		case PNFDefine.PEN_DI_TEMPLETE:
//			addDebugText("PEN_DI_TEMPLETE");
//			break;
//		case PNFDefine.PEN_DI_ACC_DATA:
//			ArrayList<PenDataClass> penDIACCDataArray = (ArrayList<PenDataClass>)obj;
//			
//			addDebugText("PEN_DI_ACC_DATA");
//			addDebugText("PEN_DI_DATA has " + String.valueOf(penDIACCDataArray.size()) + " file(s).");
//			break;
//		case PNFDefine.PEN_DI_DELETE:
//			addDebugText("PEN_DI_DELETE");
//			break;
//		case PNFDefine.PNF_DI_START:
//			addDebugText("PNF_DI_START");
//			break;
//		case PNFDefine.PNF_DI_STOP:
//			addDebugText("PNF_DI_STOP");
//			break;
//		case PNFDefine.PNF_DI_OK:
//			addDebugText("PNF_MSG_DI_OK");
//			
//			if(isDelete){
//				isDelete = false;
//				mFileSelect = 0;
//				
//				resetDiFileList();
//				
//				stopProgress();
//				
//				showAlertView(ALERTVIEW_DI_DELETE_SUCCESS);
//			}
//			break;
//		case PNFDefine.PNF_DI_FAIL:
//			addDebugText("PNF_MSG_DI_FAIL");
//			
//			if(isDelete){
//				isDelete = false;
//				mFileSelect = 0;
//				
//				resetDiFileList();
//				
//				stopProgress();
//				
//				showAlertView(ALERTVIEW_DI_DELETE_FAIL);
//			}
//			break;
//		case PNFDefine.PNF_DI_TEMP_EXIST:
//			addDebugText("PNF_DI_TEMP_EXIST");
//			break;
//		case PNFDefine.PNF_DI_TEMP_FILE_COMPLETE:
//			addDebugText("PNF_DI_TEMP_FILE_COMPLETE");
//			
//			MainDefine.penController.setDIFolderName();
//			
//			int fileCnt = MainDefine.penController.getDIFileCount();
//			if(fileCnt > 0){
//				addDebugText("dataimport has " + String.valueOf(fileCnt) + " file(s).");
//			}
//			break;
//		case PNFDefine.PNF_DI_FILE_LIST_COMPLETE:
//			addDebugText("PNF_DI_FILE_LIST_COMPLETE");
//			break;
//		}
//	}
//			
//	/*
//	 * PNF_MSG_INVALID_PROTOCOL
//	 * PNF_MSG_FAIL_LISTENING
//	 * PNF_MSG_CONNECTING_FAIL
//	 * PNF_MSG_CONNECTING
//	 * PNF_MSG_CONNECTED
//	 * PNF_MSG_PEN_RMD_ERROR
//	 * PNF_MSG_FIRST_DATA_RECV
//	 * PNF_MSG_FIRST_DATA_ERROR
//	 * PNF_MSG_SESSION_CONNECT
//	 * PNF_MSG_SESSION_OPEN
//	 * PNF_MSG_SESSION_CLOSED
//	 * 
//	 * GESTURE_RIGHT_LEFT
//	 * GESTURE_LEFT_RIGHT
//	 * GESTURE_CIRCLE_CLOCKWISE
//	 * GESTURE_CIRCLE_COUNTERCLOCKWISE
//	 * GESTURE_ZIGZAG
//	 * GESTURE_CLICK
//	 * GESTURE_DOUBLECLICK
//	 * 
//	 * PEN_E_NOT_CONNECTED
//	 * PEN_E_INVALID_PROTOCOL
//	 * PEN_E_FAIL_LISTENING
//	 */
//	@SuppressLint("HandlerLeak")
//	Handler messageHandler = new Handler() 
//	{        
//		@Override
//		public void handleMessage(Message msg) 
//		{
//			FreeLogMsg(msg.what);
//		}
//	};
//	
//	void FreeLogMsg(int what)
//	{
//		/*
//		 * BT STATUS
//		 */
//		if(what == PNFDefine.PNF_MSG_INVALID_PROTOCOL){
//			addDebugText("PNF_MSG_INVALID_PROTOCOL");
//		}else if(what == PNFDefine.PNF_MSG_FAIL_LISTENING){
//			addDebugText("PNF_MSG_FAIL_LISTENING");
//		}else if(what == PNFDefine.PNF_MSG_CONNECTING_FAIL){
//			addDebugText("PNF_MSG_CONNECTING_FAIL");
//		}else if(what == PNFDefine.PNF_MSG_CONNECTING){
//			addDebugText("PNF_MSG_CONNECTING");
//		}else if(what == PNFDefine.PNF_MSG_CONNECTED){
//			addDebugText("PNF_MSG_CONNECTED");
//		}else if(what == PNFDefine.PNF_MSG_PEN_RMD_ERROR){
//			addDebugText("PNF_MSG_PEN_RMD_ERROR");
//		}else if(what == PNFDefine.PNF_MSG_FIRST_DATA_RECV){
//			addDebugText("PNF_MSG_FIRST_DATA_RECV");
//		}else if(what == PNFDefine.PNF_MSG_FIRST_DATA_ERROR){
//			addDebugText("PNF_MSG_FIRST_DATA_ERROR");
//		}
//		
//		/*
//		 * SESSION STATUS
//		 */
//		else if(what == PNFDefine.PNF_MSG_SESSION_CONNECT){
//			addDebugText("PNF_MSG_SESSION_CONNECT");
//		}else if(what == PNFDefine.PNF_MSG_SESSION_OPEN){
//			addDebugText("PNF_MSG_SESSION_OPEN");
//		}else if(what == PNFDefine.PNF_MSG_SESSION_CLOSED){
//			addDebugText("PNF_MSG_SESSION_CLOSED");
//		}
//		
//		/*
//		 * PNF_GESTURE
//		 */
//		else if(what == PNFDefine.GESTURE_RIGHT_LEFT){
//			addDebugText("GESTURE_RIGHT_LEFT");
//		}else if(what == PNFDefine.GESTURE_LEFT_RIGHT){
//			addDebugText("GESTURE_LEFT_RIGHT");
//		}else if(what == PNFDefine.GESTURE_CIRCLE_CLOCKWISE){
//			addDebugText("GESTURE_CIRCLE_CLOCKWISE");
//		}else if(what == PNFDefine.GESTURE_CIRCLE_COUNTERCLOCKWISE){
//			addDebugText("GESTURE_CIRCLE_COUNTERCLOCKWISE");
//		}else if(what == PNFDefine.GESTURE_ZIGZAG){
//			addDebugText("GESTURE_ZIGZAG");
//		}else if(what == PNFDefine.GESTURE_CLICK){
//			addDebugText("GESTURE_CLICK");
//		}else if(what == PNFDefine.GESTURE_DOUBLECLICK){
//			addDebugText("GESTURE_DOUBLECLICK");
//		}
//		
//		/*
//		 * PEN ERROR MSG
//		 */
//		else if(what == PNFDefine.PEN_E_NOT_CONNECTED){
//			addDebugText("PEN_E_NOT_CONNECTED");
//		}else if(what == PNFDefine.PEN_E_INVALID_PROTOCOL){
//			addDebugText("PEN_E_INVALID_PROTOCOL");
//		}else if(what == PNFDefine.PEN_E_FAIL_LISTENING){
//			addDebugText("PEN_E_FAIL_LISTENING");
//		}
//	}
//	
////	void resetDownloadFileState(){
////		mSelectIndex = 0;
////		for(int i=0;i<MainDefine.diFileStateList.size();i++){
////			int diFileState = MainDefine.diFileStateList.get(i);
////			
////			if(diFileState == MainDefine.IMPORT_STATE_DOWNLOADING || diFileState == MainDefine.IMPORT_STATE_DELETEING){
////				MainDefine.diFileStateList.set(i, MainDefine.IMPORT_STATE_NONE);
////			}
////		}
////	}
//	
//	boolean existDownloadFile(){
//		boolean isRtn = false;
//		
////		mSelectIndex = 0;
////		for(int i=0;i<MainDefine.diFileStateList.size();i++){
////			int diFileState = MainDefine.diFileStateList.get(i);
////			if(diFileState == MainDefine.IMPORT_STATE_NONE){
////				mSelectIndex = i;
////				isRtn = true;
////				
////				break;
////			}
////		}
//		
//		return isRtn;
//	}
//	
//	void showAlertView(int alertTag){
//    	AlertDialog.Builder builder = null;
//    	AlertDialog alert = null;
//    	String title = "";
//    	
//    	builder = new AlertDialog.Builder(DataImportActivity.this);
//    	builder.setCancelable(false);
//    	
//    	switch(alertTag)
//    	{
//    	case ALERTVIEW_DI_DOWNLOAD_SUCCESS:
//    		title = "download success";
//    		
//    		
//    		break;
//    	case ALERTVIEW_DI_DOWNLOAD_FAIL:
//    		title = "download fail";
//    		break;
//    	case ALERTVIEW_DI_DELETE_SUCCESS:
//    		title = "delete success";
//    		break;
//    	case ALERTVIEW_DI_DELETE_FAIL:
//    		title = "delete fail";
//    		break;
//    	}
//    	
//    	builder.setTitle(title);
//    	builder.setPositiveButton(getResources().getString(R.string.COMMON_OK), new DialogInterface.OnClickListener() {
//    		public void onClick(DialogInterface dialog, int which) {
//    			dialog.dismiss();
//    		}
//    	});
//
//    	alert = builder.create();
//    	alert.show();
//	}
//	
//	int getResInt(int id){
//		return getResources().getInteger(id);
//	}
//	
//	void showProgress(){
//		if(mDialog == null) {
//			mDialog = new Dialog(DataImportActivity.this, R.style.NewDialog);
//			mDialog.setCancelable(false);
//			mDialog.addContentView(
//					new ProgressBar(DataImportActivity.this), 
//					new LayoutParams(120, 120));
//			mDialog.show();
//		}
//	}
//	
//	void stopProgress(){
//		if(mDialog != null){
//			if(mDialog.isShowing()){
//				mDialog.dismiss();
//			}
//			mDialog = null;
//		}
//	}
}
